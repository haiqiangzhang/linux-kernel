### 并发控制

#### 原子操作

- 原子整数操作  
原子整数类型为atomic\_t,其定义为
```
typedef struct {
        volatile int counter;
} atomic_t;
```
原子操作通常通过内联函数实现。
- 原子位操作
测试，置位，清除任意类型指针所指向数据对应的比特位。

#### 锁

- 自旋锁(spinlock\_t)  
适用于短期持有**（小于两次上下文切换）**，不能睡眠，不可递归申请。
- 读写自旋锁(rwlock\_t)   
读可以并发，写不可并发，读和写互斥，不能把一个读锁升级为写锁,这样会导致死锁，读锁可递归。
- 信号量(semaphore)  
信号量可被长时间持有，可睡眠，允许多个持有者（计数信号量，在初始化时初始化其使用者数量），互斥体mutex是内核提供的二值信号量。
- 读写信号量(rw\_semaphore)   
与信号量的区别同读写锁与自旋锁的区别，但要注意，所有的读写信号量都是互斥信号量。
- 完成变量(struct completion)  
适用于需要等待某件特定事情的发生时，等待方调用wait\_for\_completion()，通知方调用complet()通知等待者。
- 顺序锁（seq\_lock)  
读与写不互斥，但是写与写互斥，同时，如果读期间执行了写操作，则必须重读，在读写同时进行概率较小的情况下，顺序锁性能非常好，顺序所有一个限制是被保护单元不能包含指针
- 大内核锁（BLK)
持有者可以睡眠，睡眠时锁被释放，调度时回重新获取BLK, BLK是一种递归锁，最后一个解锁操作完成后才会释放锁。
